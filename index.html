<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="mambo : Node.js document mapper for DynamoDB" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>mambo</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/exfm/node-mambo">View on GitHub</a>

          <h1 id="project_title">mambo</h1>
          <h2 id="project_tagline">Node.js document mapper for DynamoDB</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/exfm/node-mambo/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/exfm/node-mambo/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <article class="markdown-body entry-content" itemprop="mainContentOfPage"><h2>
<a name="defining-schemas" class="anchor" href="#defining-schemas"><span class="mini-icon mini-icon-link"></span></a>Defining Schemas</h2>

<p>Mambo allows you to define schemata for table items to make dynamo friendlier to use. casting Dates, strings, and numbers correctly.  Applying default / nullable values (dynamo doesnt really allow nulls).</p>

<p>To define a schema:</p>

<pre><code>var mambo = require('mambo'),
    Schema = mambo.Schema,
    StringField = mambo.StringField,
    DateField = mambo.DateField;

var PageSchema = new Schema('Page', 'page', 'id', {
    'id': StringField,
    'title': StringField,
    'content': StringField,
    'hits': NumberField,
    'date_modified': DateField
});

var model = new mambo.Model(PageSchema);
</code></pre>

<p>The arguments for the schema constructor are:</p>

<ul>
<li>Base Table Name - Allows global prefixing to easily support switching environments.</li>
<li>Table Alias - Because the table name may change with prefixing or may need to be longer.  The alias is used to refer to a specific schema in all commands.</li>
<li>Dynamo Schema Keys - String of the key name for a hash table.  Array for a hash range table, hash key and range key respectively.</li>
<li>
<p>Spec - Key to field type mapping.  Used for ensuring data is typed correctly going in to dynamo and cast to more complex types coming out.  More on that below.</p>

<h2>
<a name="fields" class="anchor" href="#fields"><span class="mini-icon mini-icon-link"></span></a>Fields</h2>

<p>Dynamo has a very miminal set of built in field types:</p>

<ul>
<li>StringField</li>
<li>StringSetField</li>
<li>NumberField</li>
<li>NumberSetField</li>
</ul>
</li>
</ul><p>Mambo provides a few others:</p>

<ul>
<li>DateField - Date objects going in and out.  Stored as NumberField.</li>
<li>JSONField - Arrays or Objects.  Stored as StringField.</li>
<li>BooleanField - Stored as NumberField.</li>
</ul><h2>
<a name="inserting-documents" class="anchor" href="#inserting-documents"><span class="mini-icon mini-icon-link"></span></a>Inserting Documents</h2>

<p><code>Model.insert</code> provides a nice wrapper for calling <code>PutItem</code>:</p>

<pre><code>var info = {
    'id': 'about',
    'title': 'About Page',
    'content': 'TBD',
    'date_modified': new Date()
};
model.insert('page')
    .set(info)
    .commit()
    .then(successHandler, errorHandler);
</code></pre>

<p>You can also easily apply logic for conditional puts:</p>

<pre><code>model.insert('page')
    .set(info)
    .shouldNotExist('id')  // All 3 expectations the same.
    .expect('id', false)
    .expect('id', false, null)
    .commit()
    .then(successHandler, errorHandler);
</code></pre>

<h2>
<a name="events" class="anchor" href="#events"><span class="mini-icon mini-icon-link"></span></a>Events</h2>

<p>Mambo relays all events from the <a href="https://github.com/exfm/node-plata">plata</a> "driver" that you can do really interesting things with.
The emitted events are <code>retry</code>, <code>successful retry</code>, and <code>stat</code>.</p>

<pre><code>model.on('retry', function(err, action, data){
    console.log('Mambo will retry the request `'+action+'` with data `'+data+'` because `'+err.message+'`');
    console.log('At this point, you could make a call to "autoscale" your throughput for `'+date.TableName+'`');
});

model.on('retry successful', function(err, action, data){
    console.log('The retry of `'+action+'` with data `'+data+'` because `'+err.message+'` was successful.');
});

model.on('stat', function(stat, action, data){
    console.log('The action `'+action+'` with data `'+data+'` used `'+stat.consumed+'` capacity units.');
});
</code></pre>

<p>These are extremely useful for debugging and can be used for really interesting tools like <a href="https://github.com/exfm/node-dynascale">autoscaling your table throughput</a>.</p></article>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">mambo maintained by <a href="https://github.com/exfm">exfm</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
